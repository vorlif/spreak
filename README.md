# Spreak ![Test status](https://github.com/vorlif/spreak/workflows/Test/badge.svg) [![MIT license](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE) [![PkgGoDev](https://pkg.go.dev/badge/github.com/vorlif/spreak)](https://pkg.go.dev/github.com/vorlif/spreak) [![Go Report Card](https://goreportcard.com/badge/github.com/vorlif/spreak)](https://goreportcard.com/report/github.com/vorlif/spreak) [![codecov](https://codecov.io/gh/vorlif/spreak/branch/main/graph/badge.svg?token=N1O0ZE1OFW)](https://codecov.io/gh/vorlif/spreak) ![MinVersion](https://img.shields.io/badge/Go-1.16+-blue)

Flexible translation and humanization library for Go based on the concepts behind gettext. Requires Go 1.16+.

### Features

* Support for `fs.FS` (e.g. `embed`)
* Goroutine-safe and lock free through immutability
* Easily extendable
* [Powerful extractor](https://github.com/vorlif/xspreak#xspreak) for strings to simplify the localization process
* [Direct support for humanization](#package-humanize-)  of Go
  data structures
* Supports the po and mo file format.

### Usage

Using spreak is easy. First, use go get to install the latest version of the library.

```shell
go get -u github.com/vorlif/spreak@latest
```

After that spreak offers you a comprehensive interface to load and query your translations.

```go
package main

import (
	"fmt"

	"golang.org/x/text/language"

	"github.com/vorlif/spreak"
	"github.com/vorlif/spreak/localize"
)

func main() {
	// Create a bundle that loads the translations for the required languages.
	// Typically, you only need one bundle in an application.
	bundle, err := spreak.NewBundle(
		spreak.WithSourceLanguage(language.English),
		// Set the path from which the translations should be loaded
		spreak.WithDomainPath(spreak.NoDomain, "../locale"),
		// Specify the languages you want to load
		spreak.WithLanguage(language.German, language.Spanish, language.Chinese),
	)
	if err != nil {
		panic(err)
	}

	// Create a Localiser to select the language to translate.
	t := spreak.NewLocalizer(bundle, language.Spanish)

	// Translate
	fmt.Println(t.Get("Hello world"))
	// Output: Hola Mundo

	fmt.Println(t.NGetf("I have %d dog", "I have %d dogs", 2, 2))
	// Output: Tengo 2 perros

	fmt.Println(t.Localize(GetPlanet()))
	// Output: No conozco ningún planeta
}

func GetPlanet() *localize.Message {
	return &localize.Message{
		Singular: "I do not know any planet",
		Plural:   "I do not know any planets",
	}
}
```

### Extract strings ![MinVersion](https://img.shields.io/badge/Go-1.18+-blue)


Strings for the translations can be extracted via the [command line program xspreak](https://github.com/vorlif/xspreak). 
Attention, xspreak supports extraction from Go templates and therefore **requires Go 1.18+**. 
Spreak itself supports Go 1.16+.

```
go install github.com/vorlif/xspreak@v0.3.0
xspreak --help
```

xspreak creates `.pot` (PO Templates) files for this purpose which can be easily imported directly by many translation
tools.

```bash
xspreak -D path/to/source/ -p path/to/source/locale
```

How you structure the files with the translations is up to you.
Common structures are:

```text
{path}/{language}/{domain}.po
{path}/{language}.po
{path}/{domain}/{language}po
{path}/{language}/{category}/{domain}.po

Example:
.../locale/es/helloworld.po
.../locale/es.po
.../locale/helloworld/es.po
.../locale/LC_MESSAGES/domain.po
```

By default, spreak searches for translations in all these places.
If you don't like this behavior you can implement your own [Resolver](examples/features/resolver/main.go) or
[Loader](examples/features/loaders/main.go).

### Translate

The pot files generated by xspreak can be easily imported by most translation tools.
Most tools also have the ability to update existing translation via the pot file.

If you are dealing with Po files for the first time,
I recommend the application [poedit](https://poedit.net/) for a quick start.

After translation `.po` or `.mo` files are generated, which are used by spreak for looking up translations.
Attention, do not translate the `.pot` file directly, as this is only a template.

### What's next

* Read what you can extract with [xspreak](https://github.com/vorlif/xspreak#xspreak)
* Take a look in the [examples folder](./examples) for more examples of using spreak.

## Package humanize [![PkgGoDev](https://pkg.go.dev/badge/github.com/vorlif/spreak/humanize)](https://pkg.go.dev/github.com/vorlif/spreak/humanize)

The `humanize` package provides a collection of functions to convert Go data structures into a human-readable format.
It was widely adapted from the [Django project](https://github.com/django/django) and also uses the Django translations.
It should therefore be noted that the translations are under
the [Django's 3-clause BSD license](https://raw.githubusercontent.com/django/django/main/LICENSE).

To use the `humanize` package, you first need to load the languages you want to use.
You can find a list of all supported languages under [humanize/locale/](humanize/locale)

```go
package main

import (
	"fmt"
	"time"

	"golang.org/x/text/language"
	
	"github.com/vorlif/spreak/humanize"
	"github.com/vorlif/spreak/humanize/locale/ar"
	"github.com/vorlif/spreak/humanize/locale/es"
	"github.com/vorlif/spreak/humanize/locale/zhHans"
)

func main() {
	// Load the translations for the desired languages
	collection := humanize.MustNew(
		humanize.WithLocale(es.New(), ar.New(), zhHans.New()),
	)

	// Create a humanizer.
	// A humanizer features a collection of humanize functions for a language.
	h := collection.CreateHumanizer(language.English)

	// Uses the functions...
	fmt.Println(h.Intword(1_000_000_000))
	// Output: 1.0 billion

	fmt.Println(h.NaturalDay(time.Now()))
	// Output: today

	t := time.Now().Add(5 * time.Minute)
	fmt.Println(h.NaturalTime(t))
	// Output: 5 minutes from now

	d := -80 * time.Hour
	fmt.Println(h.TimeSince(d))
	// Output: 3 days, 8 hours

	// ... for different languages
	h = collection.CreateHumanizer(language.Spanish)
	fmt.Println(h.TimeSince(d))
	// Output: 3 días, 8 horas
}
```

A collection of all functions and further examples can be found in
the [documentation](https://pkg.go.dev/github.com/vorlif/spreak/humanize).

### Add translations

If you want to add a translation or add a new language, **do not do so in this repository**.
The translations in this repository are automatically generated from the Django translations and additions should also
be made there.
Use the following link to do so: https://www.transifex.com/django/django/.
For all non-translation related errors, this repository must be used.

## License

spreak is available under the MIT license. See the [LICENSE](LICENSE) file for more info.
The translations of the `humanize` packages are licensed
under [Django's BSD license](https://raw.githubusercontent.com/django/django/main/LICENSE).
